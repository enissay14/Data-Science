---
title: "Gaussian Process Regression"
author: "Yassine Landa"
date: "December 9, 2015"
output: pdf_document
---

##Sampling from a GP

exponential $k(x,y) = \sigma^2 \exp \left(- \frac{|x-y|}{\theta} \right)$ 

```{r}
exp.noyau <- function(X,Y,sigma,theta){
  k <- (sigma^2) * exp(-(abs(outer(X,Y, '-'))/theta)) 
  k
}

```

squared exp $k(x,y) = \sigma^2 \exp \left(- \frac{(x-y)^2}{2 \theta^2} \right)$
```{r}
gauss.noyau <- function(X,Y,sigma,theta){
  k <- (sigma^2) * exp(-(abs(outer(X,Y, '-'))/(2 * (theta^2)) ))
  k
}
```

Matern 5/2 $k(x,y) = \sigma^2 \left(1 + \frac{\sqrt{5}|x-y|}{\theta} + \frac{5|x-y|^2}{3 \theta^2} \right) \exp \left(- \frac{\sqrt{5}|x-y|}{\theta} \right)$ 
		
```{r}
matern52.noyau <- function(X,Y,sigma,theta){
  k <- (sigma^2) *(1 + ((sqrt(5)/theta)*abs(outer(X,Y,'-')))+((5/(3*(theta^2)))*abs(outer(X,Y, '-'))))* exp(-(sqrt(5)/theta))*abs(outer(X,Y,'-'))
  k
}
```

construction of the matrix k(x,y)
```{r}
##Use predict to define a grid for contour plot
gsize = 100
a1 <- seq(0,1,length=gsize)
a2 <- seq(0,1,length=gsize)

sigma = 2
theta = 0.3


k.exp=exp.noyau(a1,a2,sigma,theta)
k.gauss=gauss.noyau(a1,a2,sigma,theta)
k.matern52=matern52.noyau(a1,a2,sigma,theta)

```

Simulating Gaussian Samples

```{r, echo=FALSE}
library(MASS)
mu <- rep(0, 100)
X.exp <- mvrnorm(n=100, mu, k.exp)
plot(X.exp,xlim=c(-5,5),ylim=c(-5,5),col="red",pch=1)

X.gauss <- mvrnorm(n=100, mu, k.gauss)
points(X.exp,xlim=c(-5,5),ylim=c(-5,5),col="blue",pch=1)

#X.matern52 <- mvrnorm(n=100, mu, k.matern52)
#points(X.matern52,xlim=c(-5,5),ylim=c(-5,5),col="gray",pch=1)

```

##Gaussian process regression

calculating $f:\ x \in [0,1] \rightarrow x + \sin(4 \pi x)$ on 10 points

```{r}
X <- seq(0,1,length=10)
Y <- X + sin( 4 * pi * X)
plot(Y ~ X)
```

function $m$ and $c$ for conditional mean and covariance.
\begin{equation*}
\begin{split}
m(x)&=k(x,X) k(X,X)^{-1} Y\\
c(x,y)&=k(x,y) - k(x,X) k(X,X)^{-1}k(X,y)
\end{split}
\end{equation*}

```{r}
moy <- function(x,X,Y,kern,sigma,theta){
  m <- kern(x,X,sigma,theta) %*%  kern(X,X,sigma,theta)^(-1) %*% Y
  m
}
cov <- function(x,y,X,Y,kern,sigma,theta){
  c <- kern(x,y,sigma,theta) - kern(x,X,sigma,theta) %*% kern(X,X,sigma,theta)^(-1) %*% kern(X,y,sigma,theta)
  c
}
```

f(x)with the 95% confidence intervals:
```{r,echo=FALSE}
kern <- exp.noyau
sigma = 2
theta = 0.01

x <-seq(0,1,length=10)

plot(Y ~ X, xlim=c(0,1),ylim=c(-1,2))
lines(moy(x,X,Y,kern,sigma,theta),col="blue")
lines(moy(x,X,Y,kern,sigma,theta)+ 1.96 * sqrt(cov(x,x,X,Y,kern,sigma,theta)),col="red")
lines(moy(x,X,Y,kern,sigma,theta)- 1.96 * sqrt(cov(x,x,X,Y,kern,sigma,theta)),col="red")
```



