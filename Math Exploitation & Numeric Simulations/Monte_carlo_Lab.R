# Question 4 - Calc
K <- 100
n <- rpois(K,1.5)
a <- rep(0,K)
for(i in 1:K)
{
  if(n[i] > 0)
  {
    a[i] <- sum(rlnorm(n[i], meanlog=3, sdlog=0.5))
  }
}
m<- mean(a)
sd(a)

K <- 1000000
n <- rpois(K,1.5)
a <- rep(0,K)
for(i in 1:K)
{
  a[i] <- sum(rlnorm(n[i], meanlog=3, sdlog=0.5))
  a[i] <- a[i] - n[i]*m + 1.5*m
}
mean(a)
sd(a)

C0 <- 1.5*exp(3.125)
# Question 8
beta_max <- 2;
beta_min <- 1;
beta <-1.5
while(abs(l/p - 0.05) > 0.01)
{
  p <- 100;
  l <- 0;
  for(j in 1:p)
  {
    K <- 100
    n <- rpois(K,1.5)
    a <- rep(0,K)
    for(i in 1:K)
    {
      if(n[i] > 0)
      {
        a[i] <- sum(rlnorm(n[i], meanlog=3, sdlog=0.5))
      }
    }
    m<- mean(a)
    if(m > C0*beta)
    {
      l <- l+1;
    }
  }
  print(beta)
  if((l/p) - 0.05 < 0)
  {
    b <- mean(beta_min, beta)
    beta_max <- beta
    beta <- b;
  }
  else if(l/p - 0.05 > 0)
  {
    b <- mean(beta_max, beta)
    beta_min <- beta
    beta <- b;
  }
}

dyn.load("p.dll")
p = function(x) .C("p", x=as.double(x), y=as.double(-1))$y
N = 10000000
y=array(NaN,N)
for (i in 1:N)
{
  x = matrix(runif(6),ncol=6)
  y[i] = x[1]*x[2]*x[3]*x[4]*x[5]*x[6] * p(x)
}
mean(y)
mean(y) - 1.96*sd(y)/sqrt(N)
mean(y) + 1.96*sd(y)/sqrt(N)
