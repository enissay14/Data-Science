library(DiceDesign)
library(DiceKriging)
library("rgl")

n <- 30; d <- 2
X0 <- lhsDesign(n, d)$design
Xlist <- maximinESE_LHS(X0, T0=0.005*phiP(X0), inner_it=150, J=50, it=2)
X <- Xlist$design
par(mfrow=c(1,1))
pairs(X)
y <- apply(X, 1, branin)

# kriging model 1 : matern5_2 covariance structure, no trend, no nugget effect
m <- km(design=X, response=y)
plot(m)
leaveOneOut.km(m, "UK", trend.reestim=FALSE)

leaveOneOut.km(m, "UK", trend.reestim=FALSE)
RMSE()

# graphics 
n.grid <- 30
x.grid <- y.grid <- seq(0,1,length=n.grid)
design.grid <- expand.grid(x1=x.grid, x2=y.grid)

predicted.values.model1 <- predict(m, design.grid, "UK", se.compute = FALSE, checkNames= FALSE)$mean

open3d()
bg3d("white")
material3d(col = "black")
persp3d(x = x.grid,y = y.grid , apply(design.grid, 1, branin),xlab = "X", ylab = "Y", zlab = "Branin", col="red")
surface3d(x = x.grid,y = y.grid , predicted.values.model1, col="green")

#Quality criteria
Q2 <- function(y, pred){
  1 - sum((y - pred)^2)/sum((y - mean(y))^2)
}
RMSE <- function(y, pred){
  sqrt(mean((y - pred)^2))
}  
sdRMSE <- function(y, pred){
  sqrt(mean((y - pred)^2))/sd(y)
} 

Q2(apply(design.grid, 1, branin),predicted.values.model1)
RMSE(apply(design.grid, 1, branin),predicted.values.model1)
sdRMSE(apply(design.grid, 1, branin),predicted.values.model1)
